"use strict";var v=Object.create;var g=Object.defineProperty;var G=Object.getOwnPropertyDescriptor;var A=Object.getOwnPropertyNames;var C=Object.getPrototypeOf,E=Object.prototype.hasOwnProperty;var N=(o,e,t,a)=>{if(e&&typeof e=="object"||typeof e=="function")for(let s of A(e))!E.call(o,s)&&s!==t&&g(o,s,{get:()=>e[s],enumerable:!(a=G(e,s))||a.enumerable});return o};var F=(o,e,t)=>(t=o!=null?v(C(o)):{},N(e||!o||!o.__esModule?g(t,"default",{value:o,enumerable:!0}):t,o));var P=F(require("@hapi/hapi"));var y=require("nanoid");var l=require("fs"),B="src/books.json",R=()=>{(0,l.writeFileSync)("src/books.json","[]")},n=()=>JSON.parse((0,l.readFileSync)(B,"utf-8")),m=o=>{(0,l.writeFileSync)(B,JSON.stringify(o))};var D=async(o,e)=>{let{name:t,year:a,author:s,summary:r,publisher:i,pageCount:p,readPage:d,reading:k}=o.payload;if(t===void 0)return e.response({status:"fail",message:"Gagal menambahkan buku. Mohon isi nama buku"}).code(400);if(d>p)return e.response({status:"fail",message:"Gagal menambahkan buku. readPage tidak boleh lebih besar dari pageCount"}).code(400);let u=(0,y.nanoid)(16),c=new Date().toISOString(),f={id:u,name:t,year:a,author:s,summary:r,publisher:i,pageCount:p,readPage:d,finished:d===p,reading:k,insertedAt:c,updatedAt:c},h=n().concat([f]);return m(h),e.response({status:"success",message:"Buku berhasil ditambahkan",data:{bookId:u}}).code(201)};var S=(o,e)=>{let t=JSON.parse(e),r=n().filter(i=>i.reading===t>0).map(i=>({id:i.id,name:i.name,publisher:i.publisher}));return o.response({status:"success",data:{books:r}})};var O=(o,e)=>{let t=JSON.parse(e),r=n().filter(i=>i.finished===t>0).map(i=>({id:i.id,name:i.name,publisher:i.publisher}));return o.response({status:"success",data:{books:r}})};var I=(o,e)=>{let s=n().filter(r=>r.name.toLowerCase().includes(e.toLowerCase())).map(r=>({id:r.id,name:r.name,publisher:r.publisher}));return o.response({status:"success",data:{books:s}})};var T=async(o,e)=>{let{reading:t,finished:a,name:s}=o.query;if(typeof t<"u")return S(e,t);if(typeof a<"u")return O(e,a);if(typeof s<"u")return I(e,s);let i=n().map(p=>{let{id:d,name:k,publisher:u}=p;return{id:d,name:k,publisher:u}});return e.response({status:"success",data:{books:i}})};var j=async(o,e)=>{let{bookId:t}=o.params,a=n(),s;return a.forEach(r=>{r.id===t&&(s=e.response({status:"success",data:{book:r}}))}),s===void 0&&(s=e.response({status:"fail",message:"Buku tidak ditemukan"}).code(404)),s};var x=async(o,e)=>{let{name:t,year:a,author:s,summary:r,publisher:i,pageCount:p,readPage:d,reading:k}=o.payload;if(t===void 0)return e.response({status:"fail",message:"Gagal memperbarui buku. Mohon isi nama buku"}).code(400);if(d>p)return e.response({status:"fail",message:"Gagal memperbarui buku. readPage tidak boleh lebih besar dari pageCount"}).code(400);let u=n(),{bookId:c}=o.params,f=u.find(b=>c===b.id);if(f===void 0)return e.response({status:"fail",message:"Gagal memperbarui buku. Id tidak ditemukan"}).code(404);{let b={id:f.id,name:t,year:a,author:s,summary:r,publisher:i,pageCount:p,readPage:d,finished:p===d,reading:k,insertedAt:f.insertedAt,updatedAt:new Date().toISOString()};return u.splice(u.findIndex(h=>c===h.id),1,b),m(u),e.response({status:"success",message:"Buku berhasil diperbarui"})}};var q=(o,e)=>o.find(t=>t.id===e);var W=async(o,e)=>{let{bookId:t}=o.params,a=n();return typeof q(a,t)>"u"?e.response({status:"fail",message:"Buku gagal dihapus. Id tidak ditemukan"}).code(404):(a.splice(a.findIndex(r=>t===r.id),1),m(a),e.response({status:"success",message:"Buku berhasil dihapus"}))};var w=[{method:"POST",path:"/books",handler:D},{method:"GET",path:"/books",handler:T},{method:"GET",path:"/books/{bookId}",handler:j},{method:"PUT",path:"/books/{bookId}",handler:x},{method:"DELETE",path:"/books/{bookId}",handler:W}];var J=async()=>{let o=P.default.server({port:9e3,host:"localhost"});o.route(w),R(),await o.start(),console.log(`Server berjalan pada ${o.info.uri}`)};J();
