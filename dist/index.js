"use strict";var w=Object.create;var h=Object.defineProperty;var v=Object.getOwnPropertyDescriptor;var G=Object.getOwnPropertyNames;var A=Object.getPrototypeOf,E=Object.prototype.hasOwnProperty;var C=(e,o,t,s)=>{if(o&&typeof o=="object"||typeof o=="function")for(let a of G(o))!E.call(e,a)&&a!==t&&h(e,a,{get:()=>o[a],enumerable:!(s=v(o,a))||s.enumerable});return e};var F=(e,o,t)=>(t=e!=null?w(A(e)):{},C(o||!e||!e.__esModule?h(t,"default",{value:e,enumerable:!0}):t,e));var W=F(require("@hapi/hapi"));var y=require("nanoid");var l=require("fs"),B="src/books.json",R=()=>{(0,l.writeFileSync)("src/books.json","[]")},n=()=>JSON.parse((0,l.readFileSync)(B,"utf-8")),m=e=>{(0,l.writeFileSync)(B,JSON.stringify(e))};var D=async(e,o)=>{let{name:t,year:s,author:a,summary:i,publisher:r,pageCount:p,readPage:d,reading:k}=e.payload;if(t===void 0)return o.response({status:"fail",message:"Gagal menambahkan buku. Mohon isi nama buku"}).code(400);if(d>p)return o.response({status:"fail",message:"Gagal menambahkan buku. readPage tidak boleh lebih besar dari pageCount"}).code(400);let u=(0,y.nanoid)(16),c=new Date().toISOString(),f={id:u,name:t,year:s,author:a,summary:i,publisher:r,pageCount:p,readPage:d,finished:d===p,reading:k,insertedAt:c,updatedAt:c},g=n().concat([f]);return m(g),o.response({status:"success",message:"Buku berhasil ditambahkan",data:{bookId:u}}).code(201)};var S=(e,o)=>{let t=JSON.parse(o),i=n().filter(r=>r.reading===t>0).map(r=>({id:r.id,name:r.name,publisher:r.publisher}));return e.response({status:"success",data:{books:i}})};var O=(e,o)=>{let t=JSON.parse(o),i=n().filter(r=>r.finished===t>0).map(r=>({id:r.id,name:r.name,publisher:r.publisher}));return e.response({status:"success",data:{books:i}})};var I=async(e,o)=>{let{reading:t,finished:s}=e.query;if(typeof t<"u")return S(o,t);if(typeof s<"u")return O(o,s);let i=n().map(r=>{let{id:p,name:d,publisher:k}=r;return{id:p,name:d,publisher:k}});return o.response({status:"success",data:{books:i}}).code(200)};var T=async(e,o)=>{let{bookId:t}=e.params,s=n(),a;return s.forEach(i=>{i.id===t&&(a=o.response({status:"success",data:{book:i}}).code(200))}),a===void 0&&(a=o.response({status:"fail",message:"Buku tidak ditemukan"}).code(404)),a};var j=async(e,o)=>{let{name:t,year:s,author:a,summary:i,publisher:r,pageCount:p,readPage:d,reading:k}=e.payload;if(t===void 0)return o.response({status:"fail",message:"Gagal memperbarui buku. Mohon isi nama buku"}).code(400);if(d>p)return o.response({status:"fail",message:"Gagal memperbarui buku. readPage tidak boleh lebih besar dari pageCount"}).code(400);let u=n(),{bookId:c}=e.params,f=u.find(b=>c===b.id);if(f===void 0)return o.response({status:"fail",message:"Gagal memperbarui buku. Id tidak ditemukan"}).code(404);{let b={id:f.id,name:t,year:s,author:a,summary:i,publisher:r,pageCount:p,readPage:d,finished:p===d,reading:k,insertedAt:f.insertedAt,updatedAt:new Date().toISOString()};return u.splice(u.findIndex(g=>c===g.id),1,b),m(u),o.response({status:"success",message:"Buku berhasil diperbarui"}).code(200)}};var q=(e,o)=>e.find(t=>t.id===o);var x=async(e,o)=>{let{bookId:t}=e.params,s=n();return typeof q(s,t)>"u"?o.response({status:"fail",message:"Buku gagal dihapus. Id tidak ditemukan"}).code(404):(s.splice(s.findIndex(i=>t===i.id),1),m(s),o.response({status:"success",message:"Buku berhasil dihapus"}).code(200))};var P=[{method:"POST",path:"/books",handler:D},{method:"GET",path:"/books",handler:I},{method:"GET",path:"/books/{bookId}",handler:T},{method:"PUT",path:"/books/{bookId}",handler:j},{method:"DELETE",path:"/books/{bookId}",handler:x}];var J=async()=>{let e=W.default.server({port:9e3,host:"localhost"});e.route(P),R(),await e.start(),console.log(`Server berjalan pada ${e.info.uri}`)};J();
