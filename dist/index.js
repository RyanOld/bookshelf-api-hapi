"use strict";var x=Object.create;var B=Object.defineProperty;var w=Object.getOwnPropertyDescriptor;var v=Object.getOwnPropertyNames;var G=Object.getPrototypeOf,A=Object.prototype.hasOwnProperty;var E=(e,o,t,a)=>{if(o&&typeof o=="object"||typeof o=="function")for(let s of v(o))!A.call(e,s)&&s!==t&&B(e,s,{get:()=>o[s],enumerable:!(a=w(o,s))||a.enumerable});return e};var C=(e,o,t)=>(t=e!=null?x(G(e)):{},E(o||!e||!e.__esModule?B(t,"default",{value:e,enumerable:!0}):t,e));var P=C(require("@hapi/hapi"));var y=require("nanoid");var f=require("fs"),h="src/books.json",R=()=>{(0,f.writeFileSync)("src/books.json","[]")},n=()=>JSON.parse((0,f.readFileSync)(h,"utf-8")),u=e=>{(0,f.writeFileSync)(h,JSON.stringify(e))};var S=async(e,o)=>{let{name:t,year:a,author:s,summary:r,publisher:m,pageCount:i,readPage:d,reading:l}=e.payload;if(t===void 0)return o.response({status:"fail",message:"Gagal menambahkan buku. Mohon isi nama buku"}).code(400);if(d>i)return o.response({status:"fail",message:"Gagal menambahkan buku. readPage tidak boleh lebih besar dari pageCount"}).code(400);let p=(0,y.nanoid)(16),k=new Date().toISOString(),c={id:p,name:t,year:a,author:s,summary:r,publisher:m,pageCount:i,readPage:d,finished:d===i,reading:l,insertedAt:k,updatedAt:k},g=n().concat([c]);return u(g),o.response({status:"success",message:"Buku berhasil ditambahkan",data:{bookId:p}}).code(201)};var O=async(e,o)=>{let a=n().map(s=>{let{id:r,name:m,publisher:i}=s;return{id:r,name:m,publisher:i}});return o.response({status:"success",data:{books:a}}).code(200)};var D=async(e,o)=>{let{bookId:t}=e.params,a=n(),s;return a.forEach(r=>{r.id===t&&(s=o.response({status:"success",data:{book:r}}).code(200))}),s===void 0&&(s=o.response({status:"fail",message:"Buku tidak ditemukan"}).code(404)),s};var I=async(e,o)=>{let{name:t,year:a,author:s,summary:r,publisher:m,pageCount:i,readPage:d,reading:l}=e.payload;if(t===void 0)return o.response({status:"fail",message:"Gagal memperbarui buku. Mohon isi nama buku"}).code(400);if(d>i)return o.response({status:"fail",message:"Gagal memperbarui buku. readPage tidak boleh lebih besar dari pageCount"}).code(400);let p=n(),{bookId:k}=e.params,c=p.find(b=>k===b.id);if(c===void 0)return o.response({status:"fail",message:"Gagal memperbarui buku. Id tidak ditemukan"}).code(404);{let b={id:c.id,name:t,year:a,author:s,summary:r,publisher:m,pageCount:i,readPage:d,finished:i===d,reading:l,insertedAt:c.insertedAt,updatedAt:new Date().toISOString()};return p.splice(p.findIndex(g=>k===g.id),1,b),u(p),o.response({status:"success",message:"Buku berhasil diperbarui"}).code(200)}};var T=(e,o)=>e.find(t=>t.id===o);var j=async(e,o)=>{let{bookId:t}=e.params,a=n();return typeof T(a,t)>"u"?o.response({status:"fail",message:"Buku gagal dihapus. Id tidak ditemukan"}).code(404):(a.splice(a.findIndex(r=>t===r.id),1),u(a),o.response({status:"success",message:"Buku berhasil dihapus"}).code(200))};var q=[{method:"POST",path:"/books",handler:S},{method:"GET",path:"/books",handler:O},{method:"GET",path:"/books/{bookId}",handler:D},{method:"PUT",path:"/books/{bookId}",handler:I},{method:"DELETE",path:"/books/{bookId}",handler:j}];var F=async()=>{let e=P.default.server({port:9e3,host:"localhost"});e.route(q),R(),await e.start(),console.log(`Server berjalan pada ${e.info.uri}`)};F();
