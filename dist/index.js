"use strict";var w=Object.create;var h=Object.defineProperty;var W=Object.getOwnPropertyDescriptor;var v=Object.getOwnPropertyNames;var G=Object.getPrototypeOf,A=Object.prototype.hasOwnProperty;var E=(e,o,t,a)=>{if(o&&typeof o=="object"||typeof o=="function")for(let s of v(o))!A.call(e,s)&&s!==t&&h(e,s,{get:()=>o[s],enumerable:!(a=W(o,s))||a.enumerable});return e};var C=(e,o,t)=>(t=e!=null?w(G(e)):{},E(o||!e||!e.__esModule?h(t,"default",{value:e,enumerable:!0}):t,e));var P=C(require("@hapi/hapi"));var y=require("nanoid");var f=require("fs"),B="src/books.json",R=()=>{(0,f.writeFileSync)("src/books.json","[]")},n=()=>JSON.parse((0,f.readFileSync)(B,"utf-8")),m=e=>{(0,f.writeFileSync)(B,JSON.stringify(e))};var D=async(e,o)=>{let{name:t,year:a,author:s,summary:r,publisher:i,pageCount:p,readPage:d,reading:b}=e.payload;if(t===void 0)return o.response({status:"fail",message:"Gagal menambahkan buku. Mohon isi nama buku"}).code(400);if(d>p)return o.response({status:"fail",message:"Gagal menambahkan buku. readPage tidak boleh lebih besar dari pageCount"}).code(400);let u=(0,y.nanoid)(16),k=new Date().toISOString(),c={id:u,name:t,year:a,author:s,summary:r,publisher:i,pageCount:p,readPage:d,finished:d===p,reading:b,insertedAt:k,updatedAt:k},l=n().concat([c]);return m(l),o.response({status:"success",message:"Buku berhasil ditambahkan",data:{bookId:u}}).code(201)};var S=(e,o)=>{let t=JSON.parse(o),r=n().filter(i=>i.reading===t>0).map(i=>({id:i.id,name:i.name,publisher:i.publisher}));return e.response({status:"success",data:{books:r}})};var I=async(e,o)=>{let{reading:t}=e.query;if(typeof t<"u")return S(o,t);let s=n().map(r=>{let{id:i,name:p,publisher:d}=r;return{id:i,name:p,publisher:d}});return o.response({status:"success",data:{books:s}}).code(200)};var O=async(e,o)=>{let{bookId:t}=e.params,a=n(),s;return a.forEach(r=>{r.id===t&&(s=o.response({status:"success",data:{book:r}}).code(200))}),s===void 0&&(s=o.response({status:"fail",message:"Buku tidak ditemukan"}).code(404)),s};var T=async(e,o)=>{let{name:t,year:a,author:s,summary:r,publisher:i,pageCount:p,readPage:d,reading:b}=e.payload;if(t===void 0)return o.response({status:"fail",message:"Gagal memperbarui buku. Mohon isi nama buku"}).code(400);if(d>p)return o.response({status:"fail",message:"Gagal memperbarui buku. readPage tidak boleh lebih besar dari pageCount"}).code(400);let u=n(),{bookId:k}=e.params,c=u.find(g=>k===g.id);if(c===void 0)return o.response({status:"fail",message:"Gagal memperbarui buku. Id tidak ditemukan"}).code(404);{let g={id:c.id,name:t,year:a,author:s,summary:r,publisher:i,pageCount:p,readPage:d,finished:p===d,reading:b,insertedAt:c.insertedAt,updatedAt:new Date().toISOString()};return u.splice(u.findIndex(l=>k===l.id),1,g),m(u),o.response({status:"success",message:"Buku berhasil diperbarui"}).code(200)}};var j=(e,o)=>e.find(t=>t.id===o);var q=async(e,o)=>{let{bookId:t}=e.params,a=n();return typeof j(a,t)>"u"?o.response({status:"fail",message:"Buku gagal dihapus. Id tidak ditemukan"}).code(404):(a.splice(a.findIndex(r=>t===r.id),1),m(a),o.response({status:"success",message:"Buku berhasil dihapus"}).code(200))};var x=[{method:"POST",path:"/books",handler:D},{method:"GET",path:"/books",handler:I},{method:"GET",path:"/books/{bookId}",handler:O},{method:"PUT",path:"/books/{bookId}",handler:T},{method:"DELETE",path:"/books/{bookId}",handler:q}];var J=async()=>{let e=P.default.server({port:9e3,host:"localhost"});e.route(x),R(),await e.start(),console.log(`Server berjalan pada ${e.info.uri}`)};J();
