"use strict";var w=Object.create;var B=Object.defineProperty;var I=Object.getOwnPropertyDescriptor;var v=Object.getOwnPropertyNames;var x=Object.getPrototypeOf,G=Object.prototype.hasOwnProperty;var A=(e,o,t,a)=>{if(o&&typeof o=="object"||typeof o=="function")for(let s of v(o))!G.call(e,s)&&s!==t&&B(e,s,{get:()=>o[s],enumerable:!(a=I(o,s))||a.enumerable});return e};var E=(e,o,t)=>(t=e!=null?w(x(e)):{},A(o||!e||!e.__esModule?B(t,"default",{value:e,enumerable:!0}):t,e));var j=E(require("@hapi/hapi"));var y=require("nanoid");var f=require("fs"),h="src/books.json",R=()=>{(0,f.writeFileSync)("src/books.json","[]")},i=()=>(0,f.readFileSync)(h,"utf-8"),b=e=>{(0,f.writeFileSync)(h,JSON.stringify(e))};var S=async(e,o)=>{let{name:t,year:a,author:s,summary:n,publisher:u,pageCount:r,readPage:p,reading:l}=e.payload;if(t===void 0)return o.response({status:"fail",message:"Gagal menambahkan buku. Mohon isi nama buku"}).code(400);if(p>r)return o.response({status:"fail",message:"Gagal menambahkan buku. readPage tidak boleh lebih besar dari pageCount"}).code(400);let d=(0,y.nanoid)(16),m=new Date().toISOString(),k={id:d,name:t,year:a,author:s,summary:n,publisher:u,pageCount:r,readPage:p,finished:p===r,reading:l,insertedAt:m,updatedAt:m},c=i(),P=JSON.parse(c).concat([k]);return b(P),o.response({status:"success",message:"Buku berhasil ditambahkan",data:{bookId:d}}).code(201)};var O=async(e,o)=>{let a=JSON.parse(i()).map(s=>{let{id:n,name:u,publisher:r}=s;return{id:n,name:u,publisher:r}});return o.response({status:"success",data:{books:a}}).code(200)};var D=async(e,o)=>{let{bookId:t}=e.params,a=JSON.parse(i()),s;return a.forEach(n=>{n.id===t&&(s=o.response({status:"success",data:{book:n}}).code(200))}),s===void 0&&(s=o.response({status:"fail",message:"Buku tidak ditemukan"}).code(404)),s};var q=async(e,o)=>{let{name:t,year:a,author:s,summary:n,publisher:u,pageCount:r,readPage:p,reading:l}=e.payload;if(t===void 0)return o.response({status:"fail",message:"Gagal memperbarui buku. Mohon isi nama buku"});if(p>r)return o.response({status:"fail",message:"Gagal memperbarui buku. readPage tidak boleh lebih besar dari pageCount"});let d=JSON.parse(i()),{bookId:m}=e.params,k=d.find(c=>m===c.id);if(k===void 0)return o.response({status:"fail",message:"Gagal memperbarui buku. Id tidak ditemukan"});{let c={id:k.id,name:t,year:a,author:s,summary:n,publisher:u,pageCount:r,readPage:p,finished:r===p,reading:l,insertedAt:k.insertedAt,updatedAt:new Date().toISOString()};return d.splice(d.findIndex(g=>m===g.id),1,c),b(d),o.response({status:"success",message:"Buku berhasil diperbarui"}).code(200)}};var T=[{method:"POST",path:"/books",handler:S},{method:"GET",path:"/books",handler:O},{method:"GET",path:"/books/{bookId}",handler:D},{method:"PUT",path:"/books/{bookId}",handler:q},{method:"DELETE",path:"/books/{bookId}",handler:(e,o)=>"Book Deleted."}];var J=async()=>{let e=j.default.server({port:9e3,host:"localhost"});e.route(T),R(),await e.start(),console.log(`Server berjalan pada ${e.info.uri}`)};J();
