"use strict";var x=Object.create;var l=Object.defineProperty;var w=Object.getOwnPropertyDescriptor;var v=Object.getOwnPropertyNames;var W=Object.getPrototypeOf,G=Object.prototype.hasOwnProperty;var A=(o,e,t,a)=>{if(e&&typeof e=="object"||typeof e=="function")for(let s of v(e))!G.call(o,s)&&s!==t&&l(o,s,{get:()=>e[s],enumerable:!(a=w(e,s))||a.enumerable});return o};var E=(o,e,t)=>(t=o!=null?x(W(o)):{},A(e||!o||!o.__esModule?l(t,"default",{value:o,enumerable:!0}):t,o));var P=E(require("@hapi/hapi"));var y=require("nanoid");var f=require("fs"),B="src/books.json",R=()=>{(0,f.writeFileSync)("src/books.json","[]")},n=()=>JSON.parse((0,f.readFileSync)(B,"utf-8")),u=o=>{(0,f.writeFileSync)(B,JSON.stringify(o))};var S=async(o,e)=>{let{name:t,year:a,author:s,summary:r,publisher:m,pageCount:i,readPage:d,reading:g}=o.payload;if(t===void 0)return e.response({status:"fail",message:"Gagal menambahkan buku. Mohon isi nama buku"}).code(400);if(d>i)return e.response({status:"fail",message:"Gagal menambahkan buku. readPage tidak boleh lebih besar dari pageCount"}).code(400);let p=(0,y.nanoid)(16),k=new Date().toISOString(),c={id:p,name:t,year:a,author:s,summary:r,publisher:m,pageCount:i,readPage:d,finished:d===i,reading:g,insertedAt:k,updatedAt:k},h=n().concat([c]);return u(h),e.response({status:"success",message:"Buku berhasil ditambahkan",data:{bookId:p}}).code(201)};var D=async(o,e)=>{let a=n().map(s=>{let{id:r,name:m,publisher:i}=s;return{id:r,name:m,publisher:i}});return e.response({status:"success",data:{books:a}}).code(200)};var I=async(o,e)=>{let{bookId:t}=o.params,a=n(),s;return a.forEach(r=>{r.id===t&&(s=e.response({status:"success",data:{book:r}}).code(200))}),s===void 0&&(s=e.response({status:"fail",message:"Buku tidak ditemukan"}).code(404)),s};var O=async(o,e)=>{let{name:t,year:a,author:s,summary:r,publisher:m,pageCount:i,readPage:d,reading:g}=o.payload;if(t===void 0)return e.response({status:"fail",message:"Gagal memperbarui buku. Mohon isi nama buku"}).code(400);if(d>i)return e.response({status:"fail",message:"Gagal memperbarui buku. readPage tidak boleh lebih besar dari pageCount"}).code(400);let p=n(),{bookId:k}=o.params,c=p.find(b=>k===b.id);if(c===void 0)return e.response({status:"fail",message:"Gagal memperbarui buku. Id tidak ditemukan"}).code(404);{let b={id:c.id,name:t,year:a,author:s,summary:r,publisher:m,pageCount:i,readPage:d,finished:i===d,reading:g,insertedAt:c.insertedAt,updatedAt:new Date().toISOString()};return p.splice(p.findIndex(h=>k===h.id),1,b),u(p),e.response({status:"success",message:"Buku berhasil diperbarui"}).code(200)}};var T=(o,e)=>o.find(t=>t.id===e);var j=async(o,e)=>{let{bookId:t}=o.params,a=n();return typeof T(a,t)>"u"?e.response({status:"fail",message:"Buku gagal dihapus. Id tidak ditemukan"}).code(404):(a.splice(a.findIndex(r=>t===r.id),1),u(a),e.response({status:"success",message:"Buku berhasil dihapus"}).code(200))};var q=[{method:"POST",path:"/books",handler:S},{method:"GET",path:"/books",handler:D},{method:"GET",path:"/books/{bookId}",handler:I},{method:"PUT",path:"/books/{bookId}",handler:O},{method:"DELETE",path:"/books/{bookId}",handler:j}];var C=async()=>{let o=P.default.server({port:9e3,host:"localhost"});o.route(q),R(),await o.start(),console.log(`Server berjalan pada ${o.info.uri}`)};C();
